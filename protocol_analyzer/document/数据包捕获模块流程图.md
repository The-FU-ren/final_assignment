```mermaid
flowchart TD
    A[创建PacketCapture对象]
    B[设置is_running=False]
    C[接口管理]
    D[show_interfaces()]
    E[get_if_list()]
    F[get_friendly_interfaces()]
    G[选择捕获模式]
    H[固定数量捕获]
    I[实时捕获]
    J[stop_live_capture()]
    J1[设置is_running=False]
    
    A --> B
    B --> C
    C --> D
    C --> E
    C --> F
    B --> G
    G --> H
    G --> I
    J --> J1
    
    subgraph 固定数量捕获流程
    H --> H1[尝试使用指定接口]
    H1 --> H2{成功?}
    H2 -->|是| H3[返回数据包列表]
    H2 -->|否| H4[尝试备用方法]
    H4 --> H5{成功?}
    H5 -->|是| H3
    H5 -->|否| H6[返回空列表]
    end
    
    subgraph 实时捕获流程
    I --> I1[设置is_running=True]
    I1 --> I2[定义处理回调]
    I2 --> I3[定义停止条件]
    I3 --> I4{接口有效?}
    I4 -->|是| I5[循环捕获]
    I4 -->|否| I6[尝试第3层套接字]
    
    I5 --> I7{超时?}
    I7 -->|是| I8{is_running?}
    I7 -->|否| I9[处理数据包]
    I9 --> I7
    
    I6 --> I10{成功?}
    I10 -->|是| I11[循环捕获]
    I10 -->|否| I12[设置is_running=False]
    
    I11 --> I13{超时?}
    I13 -->|是| I14{is_running?}
    I13 -->|否| I15[处理数据包]
    I15 --> I13
    
    J1 --> I8
    J1 --> I14
    end
```