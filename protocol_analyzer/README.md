# 协议分析软件使用说明

## 1. 过滤规则使用方法

过滤规则使用BPF（Berkeley Packet Filter）语法，用于过滤感兴趣的数据包。以下是一些常用的过滤规则示例：

### 基本过滤规则
- **按协议过滤**：
  - `tcp` - 只捕获TCP数据包
  - `udp` - 只捕获UDP数据包
  - `icmp` - 只捕获ICMP数据包
  - `arp` - 只捕获ARP数据包
  - `ip` - 只捕获IP数据包
  - `ipv6` - 只捕获IPv6数据包

- **按端口过滤**：
  - `tcp port 80` - 只捕获TCP 80端口的数据包（HTTP）
  - `udp port 53` - 只捕获UDP 53端口的数据包（DNS）
  - `port 22` - 只捕获22端口的数据包（SSH）
  - `portrange 1-1024` - 只捕获1到1024端口范围内的数据包

- **按IP地址过滤**：
  - `host 192.168.1.1` - 只捕获与192.168.1.1相关的数据包
  - `src host 192.168.1.1` - 只捕获源IP为192.168.1.1的数据包
  - `dst host 192.168.1.1` - 只捕获目的IP为192.168.1.1的数据包
  - `net 192.168.1.0/24` - 只捕获192.168.1.0/24网段的数据包
  - `src net 192.168.1.0/24` - 只捕获源网段为192.168.1.0/24的数据包

### 组合过滤规则
使用逻辑运算符（and、or、not）组合多个过滤条件：
- `tcp and port 80` - 只捕获TCP 80端口的数据包
- `host 192.168.1.1 and tcp` - 只捕获与192.168.1.1相关的TCP数据包
- `tcp port 80 or tcp port 443` - 只捕获HTTP或HTTPS数据包
- `not arp` - 排除ARP数据包
- `src host 192.168.1.1 and not port 22` - 只捕获源IP为192.168.1.1且非SSH的数据包

### 使用示例
在图形界面中，将上述过滤规则输入到"过滤规则"输入框中，然后点击"开始捕获"按钮即可应用过滤规则。

## 2. 实时捕获功能

当前版本已实现类似Wireshark的实时捕获功能，特点如下：

- **持续捕获**：点击"开始捕获"后，持续捕获数据包，直到点击"停止捕获"为止
- **实时显示**：捕获到的数据包实时显示在列表中
- **实时更新**：状态栏实时显示捕获统计信息
- **支持过滤**：可以结合过滤规则使用
- **支持保存**：捕获过程中或捕获完成后可以保存为PCAP文件

### 使用方法
1. 在图形界面中选择网络接口
2. 可选：输入过滤规则
3. 点击"开始捕获"按钮开始实时捕获
4. 数据包会实时显示在列表中
5. 点击"停止捕获"按钮停止捕获
6. 可选：点击"保存PCAP文件"保存捕获的数据包

## 3. 其他功能

### 数据包列表
- 显示捕获的数据包列表
- 包含编号、时间、源地址、目的地址、协议、长度和信息列
- 点击数据包可查看详细信息

### 数据包详情
- 显示选中数据包的详细解码信息
- 包括各层协议的关键字段
- 支持水平和垂直滚动

### 文件操作
- 打开PCAP文件：加载已有PCAP文件进行分析
- 保存PCAP文件：保存捕获的数据包为PCAP格式

## 4. 支持的协议

- TCP/IP
- UDP
- HTTP
- HTTPS
- FTP
- SMTP
- POP3
- IMAP
- SSH
- Telnet
- DNS
- DHCP
- ICMP
- SNMP
- ARP

## 5. 运行环境

- Python 3.6+
- Scapy 2.5.0
- tkinter（Python内置）

## 6. 运行方法

### 命令行方式
```
python main.py -i <interface> -c <count> -f <filter> -o <output.pcap>
```

### 图形界面方式
```
python gui.py
```
